# Study Quest

課題をクリアするたびにレベルが上がり、参加者全体の順位が表示される学習用 Web アプリです。Google Apps Script（GAS）で動作します。

- **対象**: 生徒（学習者）と教師
- **レベル**: 1〜20（レベル 20 到達でゲームクリア）
- **出題**: 選択式・記述式（1 回 5 問、現在のレベルに応じた問題をランダム出題）

---

## 主な機能

### 生徒
- 名前と 4 桁パスワードでログイン
- 現在のレベル・順位・上位 5 人の表示
- 課題に挑戦（5 問に回答して合格でレベルアップ）
- テーマの切り替え（ライト・ダーク・オーシャン・フォレスト・サンセット・サクラ）

### 教師（管理画面）
- 生徒の追加・削除・パスワードリセット・ニックネーム変更
- 問題の追加・編集・削除（問題 ID は手入力、4 択または記述式）
- 教師用パスワードの変更

---

## 必要なもの

- Google アカウント
- （推奨）[clasp](https://github.com/google/clasp)（コマンドラインで GAS に push する場合）

---

## デプロイ方法

### 方法 A: clasp を使う

1. **clasp をインストール**  
   `npm install -g @google/clasp`
2. **ログイン**  
   `clasp login`
3. **このフォルダで新規プロジェクトを作成**  
   `clasp create --title "Study_Quest"`
   - 既に別の GAS プロジェクトで開発している場合は、`.clasp.json` を削除してから実行すると、新しい scriptId が発行されます。
4. **コードを push**  
   `clasp push`
5. **GAS でデプロイ**  
   [script.google.com](https://script.google.com) で該当プロジェクトを開き、「デプロイ」→「新しいデプロイ」→ 種類「ウェブアプリ」を選択してデプロイする。
6. **（任意）既存のスプレッドシートを使う**  
   あらかじめ生徒・問題を入力したスプレッドシートを使う場合は、GAS エディタで関数 **`setSpreadsheetId`** を 1 回実行する。  
   - Code.gs 内の `setSpreadsheetId` で、引数なしで実行するとデフォルトの ID が使われます。別のスプレッドシートを使う場合は、関数内の ID を書き換えるか、実行時に引数で ID を渡してください。  
   - スプレッドシート ID は、スプレッドシートの URL の `/d/` と `/edit` の間の文字列です。

### 方法 B: clasp を使わない

1. [script.google.com](https://script.google.com) で「新しいプロジェクト」を作成する。
2. デフォルトの `Code.gs` の内容を、このリポジトリの **Code.gs** の内容で置き換える。
3. 「+」→「HTML」でファイルを追加し、名前を **Index** にし、**Index.html** の内容を貼り付ける。
4. 「プロジェクトの設定」→「appsscript.json」をエディタで表示し、このリポジトリの **appsscript.json** の内容に合わせる（`timeZone` や `webapp` の設定を含む）。
5. 「デプロイ」→「新しいデプロイ」→ 種類「ウェブアプリ」でデプロイする。
6. 既存のスプレッドシートを使う場合は、関数 **`setSpreadsheetId`** を 1 回実行する。

---

## スプレッドシートについて

- **初回実行時**: スプレッドシート ID が未設定なら、自動で「Study_Quest_データ」という名前のスプレッドシートが作成され、シート「問題」「生徒データ」「設定」が初期化されます。
- **既存のスプレッドシートを使う**: 上記のとおり、GAS エディタで **`setSpreadsheetId(スプレッドシートID)`** を 1 回実行すると、そのスプレッドシートを参照します。  
  シート名は「問題」「生徒データ」「設定」、列構成は Code.gs のヘッダー行に従ってください。
- 生徒・問題は、管理画面からだけでなく**スプレッドシートに直接入力**しても反映されます。

---

## プロジェクト構成

| ファイル | 説明 |
|----------|------|
| `Code.gs` | サーバー側ロジック（doGet、スプレッドシート操作、生徒・教師用 API） |
| `Index.html` | クライアント側 UI（ログイン、メイン、課題、結果、管理画面、設定モーダル） |
| `appsscript.json` | GAS の設定（タイムゾーン、ウェブアプリの実行権限など） |
| `Seito_Manual.md` | 生徒向け取扱説明書 |

---

## 注意事項

- **`.clasp.json`** には、clasp で作成した GAS プロジェクトの scriptId が含まれます。このリポジトリを clone して自分用のプロジェクトとして使う場合は、`clasp create` で新規プロジェクトを作成すると、自分の `.clasp.json` が生成されます。**他人の .clasp.json をそのまま push すると、他人のプロジェクトに書き込むことになるため、共有リポジトリに .clasp.json をコミットしないことを推奨します**（`.gitignore` に `.clasp.json` を追加するなど）。
- 教師の初期パスワードは **1234** です。初回ログイン後に管理画面から必ず変更してください。
- 生徒のパスワードはスプレッドシートに平文で保存されます。本番利用時は取り扱いに注意してください。

---

## ドキュメント

- **[Seito_Manual.md](Seito_Manual.md)** … 生徒向け取扱説明書（配付用）

---

## ライセンス

MIT License を想定しています。利用・改変・再配布は自己責任で行ってください。
